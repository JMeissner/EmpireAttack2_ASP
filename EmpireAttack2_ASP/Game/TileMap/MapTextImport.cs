using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Hosting.Internal;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading.Tasks;

namespace EmpireAttack2_ASP.Game.TileMap
{
    public class MapTextImport : MapBase
    {
        public MapTextImport(string path)
        {
            MapDataToTileMap(path);
        }

        private void MapDataToTileMap(string path)
        {
            //string dataDir = AppDomain.CurrentDomain.GetData("DataDirectory").ToString();
            //string dataDir = AppDomain.CurrentDomain.BaseDirectory.ToString() + "/App_Data";
            string dataDir = Path.Combine(GameManager.Instance.webRootPath, "App_Data", path);
            string _mapData = System.IO.File.ReadAllText(dataDir);
            //string _mapData = "32:32#0,0,W;0,1,W;0,2,W;0,3,W;0,4,W;0,5,W;0,6,W;0,7,W;0,8,W;0,9,W;0,10,W;0,11,W;0,12,W;0,13,W;0,14,W;0,15,W;0,16,W;0,17,W;0,18,W;0,19,W;0,20,W;0,21,W;0,22,W;0,23,W;0,24,W;0,25,W;0,26,W;0,27,W;0,28,W;0,29,W;0,30,W;0,31,W;1,0,W;1,1,W;1,2,W;1,3,W;1,4,N;1,5,N;1,6,N;1,7,N;1,8,N;1,9,N;1,10,N;1,11,N;1,12,N;1,13,N;1,14,N;1,15,N;1,16,N;1,17,N;1,18,N;1,19,N;1,20,N;1,21,N;1,22,N;1,23,N;1,24,N;1,25,N;1,26,N;1,27,N;1,28,N;1,29,W;1,30,W;1,31,W;2,0,W;2,1,W;2,2,N;2,3,N;2,4,N;2,5,N;2,6,N;2,7,N;2,8,N;2,9,N;2,10,N;2,11,N;2,12,N;2,13,N;2,14,U;2,15,N;2,16,N;2,17,N;2,18,N;2,19,N;2,20,N;2,21,N;2,22,N;2,23,N;2,24,N;2,25,N;2,26,N;2,27,N;2,28,N;2,29,N;2,30,W;2,31,W;3,0,W;3,1,N;3,2,N;3,3,N;3,4,N;3,5,U;3,6,N;3,7,N;3,8,N;3,9,N;3,10,N;3,11,N;3,12,N;3,13,N;3,14,N;3,15,N;3,16,N;3,17,N;3,18,N;3,19,N;3,20,N;3,21,N;3,22,N;3,23,N;3,24,N;3,25,N;3,26,N;3,27,N;3,28,N;3,29,N;3,30,N;3,31,W;4,0,W;4,1,N;4,2,N;4,3,N;4,4,N;4,5,N;4,6,N;4,7,N;4,8,N;4,9,N;4,10,F;4,11,F;4,12,F;4,13,N;4,14,N;4,15,N;4,16,N;4,17,N;4,18,N;4,19,N;4,20,N;4,21,N;4,22,N;4,23,N;4,24,N;4,25,N;4,26,N;4,27,N;4,28,N;4,29,N;4,30,N;4,31,W;5,0,W;5,1,N;5,2,N;5,3,N;5,4,N;5,5,N;5,6,F;5,7,F;5,8,F;5,9,F;5,10,F;5,11,F;5,12,F;5,13,F;5,14,F;5,15,F;5,16,F;5,17,N;5,18,N;5,19,N;5,20,N;5,21,N;5,22,N;5,23,N;5,24,N;5,25,N;5,26,N;5,27,N;5,28,N;5,29,N;5,30,N;5,31,W;6,0,W;6,1,N;6,2,N;6,3,N;6,4,N;6,5,N;6,6,H;6,7,H;6,8,H;6,9,F;6,10,F;6,11,F;6,12,F;6,13,F;6,14,F;6,15,F;6,16,F;6,17,F;6,18,F;6,19,N;6,20,N;6,21,N;6,22,N;6,23,N;6,24,N;6,25,N;6,26,N;6,27,N;6,28,N;6,29,N;6,30,N;6,31,W;7,0,W;7,1,N;7,2,N;7,3,N;7,4,N;7,5,N;7,6,H;7,7,F;7,8,H;7,9,H;7,10,H;7,11,F;7,12,F;7,13,F;7,14,F;7,15,F;7,16,F;7,17,F;7,18,F;7,19,F;7,20,F;7,21,N;7,22,N;7,23,N;7,24,N;7,25,N;7,26,N;7,27,N;7,28,N;7,29,N;7,30,N;7,31,W;8,0,W;8,1,N;8,2,N;8,3,N;8,4,N;8,5,N;8,6,H;8,7,F;8,8,F;8,9,H;8,10,H;8,11,H;8,12,H;8,13,H;8,14,H;8,15,F;8,16,F;8,17,F;8,18,F;8,19,F;8,20,F;8,21,F;8,22,N;8,23,N;8,24,N;8,25,N;8,26,N;8,27,N;8,28,N;8,29,N;8,30,W;8,31,W;9,0,W;9,1,N;9,2,N;9,3,N;9,4,N;9,5,N;9,6,H;9,7,F;9,8,F;9,9,N;9,10,H;9,11,H;9,12,N;9,13,H;9,14,H;9,15,H;9,16,F;9,17,F;9,18,F;9,19,F;9,20,F;9,21,F;9,22,N;9,23,N;9,24,N;9,25,N;9,26,N;9,27,N;9,28,W;9,29,W;9,30,W;9,31,W;10,0,W;10,1,N;10,2,N;10,3,N;10,4,N;10,5,H;10,6,N;10,7,N;10,8,N;10,9,N;10,10,N;10,11,U;10,12,U;10,13,N;10,14,N;10,15,H;10,16,H;10,17,H;10,18,F;10,19,F;10,20,F;10,21,F;10,22,F;10,23,N;10,24,N;10,25,N;10,26,N;10,27,W;10,28,W;10,29,N;10,30,N;10,31,W;11,0,W;11,1,N;11,2,N;11,3,N;11,4,N;11,5,H;11,6,N;11,7,N;11,8,N;11,9,N;11,10,N;11,11,U;11,12,U;11,13,N;11,14,N;11,15,N;11,16,H;11,17,H;11,18,H;11,19,F;11,20,H;11,21,F;11,22,F;11,23,F;11,24,N;11,25,N;11,26,W;11,27,W;11,28,N;11,29,N;11,30,N;11,31,W;12,0,W;12,1,N;12,2,N;12,3,N;12,4,N;12,5,H;12,6,F;12,7,N;12,8,N;12,9,N;12,10,N;12,11,N;12,12,N;12,13,N;12,14,N;12,15,N;12,16,N;12,17,N;12,18,H;12,19,H;12,20,H;12,21,F;12,22,F;12,23,F;12,24,F;12,25,W;12,26,W;12,27,N;12,28,N;12,29,N;12,30,N;12,31,W;13,0,W;13,1,N;13,2,N;13,3,N;13,4,N;13,5,H;13,6,H;13,7,F;13,8,F;13,9,W;13,10,W;13,11,W;13,12,W;13,13,W;13,14,W;13,15,W;13,16,W;13,17,N;13,18,N;13,19,N;13,20,H;13,21,H;13,22,F;13,23,F;13,24,W;13,25,W;13,26,N;13,27,N;13,28,N;13,29,N;13,30,N;13,31,W;14,0,W;14,1,N;14,2,N;14,3,C;14,4,N;14,5,N;14,6,H;14,7,H;14,8,W;14,9,W;14,10,H;14,11,H;14,12,H;14,13,W;14,14,W;14,15,N;14,16,W;14,17,W;14,18,N;14,19,N;14,20,F;14,21,H;14,22,H;14,23,W;14,24,W;14,25,N;14,26,N;14,27,N;14,28,N;14,29,N;14,30,N;14,31,W;15,0,W;15,1,N;15,2,N;15,3,N;15,4,N;15,5,N;15,6,N;15,7,W;15,8,W;15,9,F;15,10,H;15,11,H;15,12,H;15,13,H;15,14,W;15,15,N;15,16,N;15,17,W;15,18,W;15,19,F;15,20,F;15,21,F;15,22,W;15,23,W;15,24,H;15,25,H;15,26,N;15,27,N;15,28,N;15,29,N;15,30,N;15,31,W;16,0,W;16,1,N;16,2,W;16,3,W;16,4,W;16,5,W;16,6,W;16,7,W;16,8,H;16,9,H;16,10,N;16,11,N;16,12,N;16,13,H;16,14,W;16,15,N;16,16,N;16,17,N;16,18,W;16,19,W;16,20,W;16,21,W;16,22,W;16,23,N;16,24,H;16,25,H;16,26,N;16,27,N;16,28,C;16,29,N;16,30,N;16,31,W;17,0,W;17,1,W;17,2,W;17,3,N;17,4,N;17,5,N;17,6,N;17,7,N;17,8,N;17,9,H;17,10,N;17,11,N;17,12,N;17,13,H;17,14,W;17,15,H;17,16,H;17,17,H;17,18,N;17,19,N;17,20,N;17,21,N;17,22,N;17,23,N;17,24,H;17,25,N;17,26,N;17,27,N;17,28,N;17,29,N;17,30,N;17,31,W;18,0,W;18,1,N;18,2,N;18,3,N;18,4,N;18,5,N;18,6,N;18,7,N;18,8,N;18,9,H;18,10,N;18,11,N;18,12,N;18,13,N;18,14,W;18,15,F;18,16,F;18,17,H;18,18,H;18,19,N;18,20,U;18,21,N;18,22,N;18,23,N;18,24,H;18,25,N;18,26,N;18,27,N;18,28,N;18,29,N;18,30,N;18,31,W;19,0,W;19,1,N;19,2,N;19,3,N;19,4,N;19,5,N;19,6,N;19,7,U;19,8,U;19,9,H;19,10,N;19,11,N;19,12,N;19,13,N;19,14,W;19,15,F;19,16,F;19,17,F;19,18,N;19,19,U;19,20,U;19,21,N;19,22,N;19,23,N;19,24,H;19,25,N;19,26,N;19,27,N;19,28,N;19,29,N;19,30,N;19,31,W;20,0,W;20,1,N;20,2,N;20,3,N;20,4,N;20,5,N;20,6,N;20,7,U;20,8,N;20,9,H;20,10,N;20,11,N;20,12,N;20,13,N;20,14,W;20,15,F;20,16,F;20,17,F;20,18,N;20,19,N;20,20,N;20,21,N;20,22,N;20,23,H;20,24,H;20,25,F;20,26,N;20,27,N;20,28,N;20,29,N;20,30,N;20,31,W;21,0,W;21,1,N;21,2,N;21,3,N;21,4,N;21,5,N;21,6,N;21,7,N;21,8,N;21,9,H;21,10,N;21,11,N;21,12,N;21,13,N;21,14,W;21,15,F;21,16,F;21,17,F;21,18,N;21,19,N;21,20,N;21,21,N;21,22,H;21,23,H;21,24,F;21,25,F;21,26,N;21,27,U;21,28,U;21,29,N;21,30,N;21,31,W;22,0,W;22,1,N;22,2,N;22,3,N;22,4,N;22,5,N;22,6,N;22,7,N;22,8,N;22,9,H;22,10,H;22,11,N;22,12,U;22,13,W;22,14,W;22,15,W;22,16,U;22,17,F;22,18,F;22,19,H;22,20,H;22,21,H;22,22,H;22,23,F;22,24,F;22,25,F;22,26,F;22,27,U;22,28,U;22,29,N;22,30,N;22,31,W;23,0,W;23,1,N;23,2,N;23,3,N;23,4,N;23,5,N;23,6,N;23,7,N;23,8,N;23,9,N;23,10,H;23,11,H;23,12,W;23,13,W;23,14,W;23,15,W;23,16,W;23,17,H;23,18,H;23,19,H;23,20,H;23,21,N;23,22,N;23,23,N;23,24,F;23,25,F;23,26,N;23,27,N;23,28,N;23,29,N;23,30,N;23,31,W;24,0,W;24,1,N;24,2,N;24,3,N;24,4,N;24,5,N;24,6,N;24,7,N;24,8,N;24,9,N;24,10,N;24,11,N;24,12,W;24,13,W;24,14,W;24,15,W;24,16,W;24,17,N;24,18,N;24,19,N;24,20,N;24,21,N;24,22,N;24,23,N;24,24,N;24,25,N;24,26,N;24,27,N;24,28,N;24,29,N;24,30,N;24,31,W;25,0,W;25,1,N;25,2,N;25,3,N;25,4,N;25,5,N;25,6,N;25,7,N;25,8,N;25,9,N;25,10,N;25,11,N;25,12,U;25,13,W;25,14,W;25,15,W;25,16,U;25,17,N;25,18,N;25,19,N;25,20,N;25,21,N;25,22,N;25,23,N;25,24,N;25,25,N;25,26,N;25,27,N;25,28,N;25,29,N;25,30,N;25,31,W;26,0,W;26,1,N;26,2,N;26,3,N;26,4,N;26,5,N;26,6,N;26,7,N;26,8,N;26,9,N;26,10,N;26,11,N;26,12,N;26,13,N;26,14,N;26,15,N;26,16,N;26,17,N;26,18,N;26,19,N;26,20,N;26,21,N;26,22,N;26,23,N;26,24,N;26,25,N;26,26,N;26,27,N;26,28,N;26,29,N;26,30,N;26,31,W;27,0,W;27,1,W;27,2,N;27,3,N;27,4,N;27,5,N;27,6,N;27,7,N;27,8,N;27,9,N;27,10,N;27,11,N;27,12,N;27,13,N;27,14,N;27,15,N;27,16,N;27,17,N;27,18,N;27,19,N;27,20,N;27,21,N;27,22,N;27,23,N;27,24,N;27,25,N;27,26,N;27,27,N;27,28,N;27,29,N;27,30,N;27,31,W;28,0,W;28,1,W;28,2,N;28,3,N;28,4,N;28,5,N;28,6,U;28,7,N;28,8,N;28,9,N;28,10,N;28,11,N;28,12,N;28,13,N;28,14,N;28,15,N;28,16,N;28,17,N;28,18,N;28,19,N;28,20,N;28,21,N;28,22,N;28,23,N;28,24,N;28,25,N;28,26,N;28,27,N;28,28,N;28,29,N;28,30,W;28,31,W;29,0,W;29,1,W;29,2,W;29,3,N;29,4,N;29,5,N;29,6,N;29,7,N;29,8,N;29,9,N;29,10,N;29,11,N;29,12,N;29,13,N;29,14,N;29,15,N;29,16,N;29,17,N;29,18,N;29,19,N;29,20,N;29,21,N;29,22,N;29,23,N;29,24,N;29,25,N;29,26,N;29,27,N;29,28,N;29,29,N;29,30,W;29,31,W;30,0,W;30,1,W;30,2,W;30,3,W;30,4,N;30,5,N;30,6,N;30,7,N;30,8,N;30,9,N;30,10,N;30,11,N;30,12,N;30,13,N;30,14,N;30,15,N;30,16,N;30,17,N;30,18,N;30,19,N;30,20,N;30,21,N;30,22,N;30,23,N;30,24,N;30,25,N;30,26,N;30,27,N;30,28,W;30,29,W;30,30,W;30,31,W;31,0,W;31,1,W;31,2,W;31,3,W;31,4,W;31,5,W;31,6,W;31,7,W;31,8,W;31,9,W;31,10,W;31,11,W;31,12,W;31,13,W;31,14,W;31,15,W;31,16,W;31,17,W;31,18,W;31,19,W;31,20,W;31,21,W;31,22,W;31,23,W;31,24,W;31,25,W;31,26,W;31,27,W;31,28,W;31,29,W;31,30,W;31,31,W";

            string[] _sizeAndTiles = _mapData.Split('#');

            string[] _mapSize = _sizeAndTiles[0].Split(':');
            int mapSizeX = int.Parse(_mapSize[0]);
            int mapSizeY = int.Parse(_mapSize[1]);

            string[] _mapTiles = _sizeAndTiles[1].Split(';');

            //Array Init
            tileMap = new Tile[mapSizeX][];
            for (int x = 0; x < mapSizeX; x++)
            {
                tileMap[x] = new Tile[mapSizeY];
            }

            foreach(string t in _mapTiles)
            {
                string[] _t = t.Split(',');
                int i = int.Parse(_t[0]);
                int j = int.Parse(_t[1]);
                switch (_t[2])
                {
                    case "N": tileMap[i][j] = new Tile(TileType.Normal, i, j, true); break;
                    case "W": tileMap[i][j] = new Tile(TileType.Water, i, j, true); break;
                    case "F": tileMap[i][j] = new Tile(TileType.Forest, i, j, true); break;
                    case "H": tileMap[i][j] = new Tile(TileType.Hills, i, j, true); break;
                    case "U": tileMap[i][j] = new Tile(TileType.Urban, i, j, true); break;
                    case "C": tileMap[i][j] = new Tile(TileType.Capital, i, j, true); break;
                    default: throw new Exception("tiletype did not match (Import->Convert Shorttype to Tiletype)");
                }
            }
            System.Diagnostics.Debug.WriteLine("Map Import Completed.");
        }
    }
}
